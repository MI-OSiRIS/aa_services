# OSiRIS LDAP Schema Extensions
# based on the mg2.org OID namespace 1.3.5.1.3.1.17128
# sliced off .313 for OSiRIS attributes

# Attributes
attributeType ( 1.3.5.1.3.1.17128.313.1.1
    NAME 'osirisKeyThumbprint',
    DESC 'a Base64-URL encoded SHA256 hash of the DER encoded RSA signing public key'
    EQUALITY caseExactMatch
    SINGLE_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

attributeType (1.3.5.1.3.1.17128.313.1.2
    NAME ('oeui' 'osirisEntityUniqueID')
    DESC 'a UUID uniquely identifying an OSiRIS entity, generated by oakd'
    EQUALITY caseIgnoreMatch
    SINGLE_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

attributeType (1.3.5.1.3.1.17128.313.1.3
    NAME 'osirisOakEndpoint'
    DESC 'full URL of the OAK (OAA keyring service) endpoint'
    EQUALITY caseIgnoreMatch
    SINGLE_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

attributeType (1.3.5.1.3.1.17128.313.1.4
    NAME 'osirisStpEndpoint'
    DESC 'full URL of the STP (OAA to native gateway service) endpoint'
    EQUALITY caseIgnoreMatch
    SINGLE_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

attributeType (1.3.5.1.3.1.17128.313.1.5
    NAME 'osirisEncryptionCertificate'
    DESC 'a DER encoded encryption certificate'
    EQUALITY caseExactMatch
    SINGLE_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

attributeType (1.3.5.1.3.1.17128.313.1.6
    NAME 'osirisSigningCertificate'
    DESC 'a DER encoded signing certificate'
    EQUALITY caseExactMatch
    SINGLE_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

attributeType (1.3.5.1.3.1.17128.313.1.7
    NAME 'osirisAccessTokens'
    DESC 'an entitys current set of issued osirisAccessTokens'
    EQUALITY caseExactMatch
    MULTI_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

attributeType (1.3.5.1.3.1.17128.313.1.8
    NAME 'osirisPreviousEncryptionCertificates'
    DESC 'all historical DER encoded encryption certificates for this entity'
    EQUALITY caseExactMatch
    MULTI_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

attributeType (1.3.5.1.3.1.17128.313.1.9
    NAME 'osirisPreviousSigningCertificates'
    DESC 'all historical DER encoded signing certificates for this entity'
    EQUALITY caseExactMatch
    MULTI_VALUE
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )

# Object Classes
objectClass ( 1.3.5.1.3.1.17128.313.1 
    NAME 'osirisEntity' SUP top STRUCTURAL 
    MUST ( osirisEntityUniqueID ) 
    MAY ( 
        osirisKeyThumbprint $ cn $ osirisEncryptionCertificate $ osirisSigningCertificate $ description $
        uid $ ou $ osirisPreviousSigningCertificates $ osirisPreviousEncryptionCertificates $ 
        eduPersonAffiliation $ eduPersonNickName $ eduPersonOrgDN $ eduPersonOrgUnitDN $ 
        eduPersonPrimaryAffiliation $ eduPersonPrincipalName $ eduPersonEntitlement $
        eduPersonPrimaryOrgUnitDN $ eduPersonScopedAffiliation    
    ) 
)

objectClass ( 1.3.5.1.3.1.17128.313.2 
    NAME 'osirisResourceAuthority' SUP osirisEntity STRUCTURAL 
    MUST ( osirisKeyThumbprint $ osirisSigningCertificate $ osirisEncryptionCertificate $ osirisStpEndpoint ) 
)

objectClass ( 1.3.5.1.3.1.17128.313.3 
    NAME 'osirisCentralAuthority' SUP osirisEntity STRUCTURAL 
    MUST ( osirisKeyThumbprint $ osirisOakEndpoint $ osirisSigningCertificate $ osirisEncryptionCertificate ) 
)
    
objectClass ( 1.3.5.1.3.1.17128.313.4 
    NAME 'osirisGroup' SUP groupOfNames STRUCTURAL 
    DESC 'groups of osirisEntity objects'
    MUST ( cn $ osirisEntityUniqueID ) 
    MAY ( description $ member ) 
)

objectClass ( 1.3.5.1.3.1.17128.313.5
    NAME 'osirisPerson' SUP osirisEntity STRUCTURAL
    DESC 'a person who is a user of OSiRIS systems'
    MUST ( cn $ sn $ givenName $ eduPersonPrincipalName $ eduPersonOrgDN $ uid $ userPassword $ mail )
)

